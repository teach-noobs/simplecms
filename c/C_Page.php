<?php//// Конттроллер страниц.//class C_Page extends C_Base{	//	// Конструктор.	//	public function __construct(){		parent::__construct();	}		public function before(){		//$this->needLogin = true; // раскоментируйте, чтобы закрыть доступ ко всем страницам данного контроллера		parent::before();	}		public function action_index(){		$url = implode('/', $this->params);				if($url == '')			$url = 'home';					$mPages = M_Pages::Instance();				$page = $mPages->getByUrl($url);				if(empty($page)){			$this->action_404();			return;		}					$this->title .= '->' . $page['title'];		$this->keywords .= $page['keywords'];		$this->description .= $page['description'];				$t = M_Templates::Instance()->get($page['id_template']);		$template = ($t['path']) ? $t['path'] : 'v_index.php';				if($page['id_menu'] != 0)			$this->left_menu = M_Menu::Instance()->getWithPages($page['id_menu']);		 else{			 /* Допилено после семинара 				Если id_parent != 0, т.е страница не первого уровня, то получаем базовый раздел				по первому элементу урла.				Это необходимо для вывода в левое иерархическое меню страниц второго уровня.				Если хотите убрать это изменение, удалите одну сточку ниже коммента. */			 			$base_part = ($page['id_parent'] != 0) ? $mPages->getByUrl($this->params[0]) : $page;			$this->left_menu = $mPages->getByParent($base_part['id_page']);		} 				$this->content = $this->Template("v/$template", array('page' => $page));	}		public function action_search(){		$this->title .= '->Поиск';		$templates = array();		$error = true;				if($this->isPost())		{			$mSearch = M_Search::Instance();			$results = $mSearch->find($_POST['search']);						if($results !== false)				foreach($results as $key => $value){					if(count($value) > 0)										$templates[] = $this->Template('v/' . $mSearch->get_template($key),														array('records' => $value));								}						$error = false;		}				$this->content = $this->Template('v/v_search.php',												array('templates' => $templates));	}		public function action_404(){		$this->title .= '->404';		$this->content = $this->Template('v/v_404.php');	}}