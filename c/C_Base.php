<?php//// Базовый контроллер сайта.//abstract class C_Base extends C_Controller{	protected $title;		// заголовок страницы	protected $content;		// содержание страницы	protected $needLogin;	// необходима ли авторизация	protected $user;		// авторизованный пользователь || null	protected $keywords;			protected $description;			protected $top_menu;			protected $left_menu;	protected $styles;	protected $scripts;		protected $adminlink; // ссылка на админку для залогиненых		//	// Конструктор.	//	function __construct()	{			$this->needLogin = false;		$this->keywords = '';		$this->description = '';		$this->top_menu = M_Menu::Instance()->getTopMenu();		$this->left_menu = $this->top_menu; // по умолчанию. Дети переопределят.		$this->user = M_Users::Instance()->Get();		$this->styles = array('style', 'lightbox', 'navbar');		$this->scripts = array('jQuery', 'html5shiv', 'lightbox-2.6.min', 'jquery.cycle2.min');		$this->adminlink = false;	}		protected function before()	{		if($this->needLogin && $this->user === null)			$this->redirect('/auth/login');			if(M_Users::Instance()->Can('PAGES')){			$this->styles[] = 'jquery-ui-1.10.1.custom.min';			$this->scripts[] = 'jquery-ui-1.10.1.custom.min';			$this->scripts[] = 'ckeditor/ckeditor';			$this->scripts[] = 'widget-controls';			$this->scripts[] = 'widget-replaces';			$this->scripts[] = 'widget-toggle';			$this->adminlink = true;		}				$this->title = 'Название сайта';		$this->content = '';	}		//	// Генерация базового шаблонаы	//		public function render()	{		$url = implode('/', $this->params);		$mMenu = M_Menu::Instance();				foreach($this->top_menu as $key => $temp)		   $this->top_menu[$key]['is_active'] = $mMenu->is_active($url, $temp['full_cache_url']);		  		foreach($this->left_menu as $key => $temp){		   $this->left_menu[$key]['is_active'] = $mMenu->is_active($url, $temp['full_cache_url']);		   		   if($this->left_menu[$key]['is_active']){		    $this->left_menu[$key]['children'] = M_Pages::Instance()->getByParent($temp['id_page']);		    		    foreach($this->left_menu[$key]['children'] as $k => $child)		     $this->left_menu[$key]['children'][$k]['is_active'] = $mMenu->is_active($url, $child['full_cache_url']);		   }		 }		$vars = array('title' => $this->title, 'content' => $this->content, 					'keywords' => $this->keywords, 'description' => $this->description,					'top_menu' => $this->top_menu, 'left_menu' => $this->left_menu,					 'styles' => $this->styles, 'scripts' => $this->scripts,					 'adminlink'=> $this->adminlink);			$page = $this->Template("v/base_templates/".MAIN_TEMPLATE, $vars);						echo $this->replace_widgets($page);	}	}